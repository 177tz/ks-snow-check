<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨‚å–®é…è²¨æŸ¥è©¢ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-md bg-white rounded-xl shadow-lg overflow-hidden p-6">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-2">ğŸ“¦ ksé…è²¨çµæœæŸ¥è©¢</h2>
        <p class="text-center text-gray-500 text-sm mb-6">è«‹è¼¸å…¥å®Œæ•´çš„ã€Œç¾¤å…§åç¨±ã€æŸ¥è©¢</p>
        
        <div class="space-y-4">
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2" for="searchName">
                    è¨‚è³¼äººåç¨±
                </label>
                <input class="w-full border-2 border-gray-200 rounded-lg py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:border-blue-500 transition" 
                       id="searchName" type="text" placeholder="ä¾‹å¦‚ï¼šYuu">
            </div>
            
            <button onclick="searchOrder()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 shadow-md">
                ğŸ” ç«‹å³æŸ¥è©¢
            </button>
        </div>

        <div id="loading" class="hidden mt-6 text-center">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
            <p class="text-gray-500 text-sm mt-2">è³‡æ–™è®€å–ä¸­ï¼Œè«‹ç¨å€™...</p>
        </div>

        <div id="errorMsg" class="hidden mt-4 p-3 bg-red-100 text-red-700 rounded-lg text-sm text-center"></div>

        <div id="resultArea" class="mt-6 space-y-3 hidden">
            </div>
    </div>

    <script>
        // âš ï¸âš ï¸âš ï¸ è«‹å‹™å¿…å°‡é€™è£¡æ›æˆæ‚¨æœ€æ–°çš„ Google Apps Script ç¶²å€ âš ï¸âš ï¸âš ï¸
        const API_URL = 'https://script.google.com/macros/s/AKfycbynblO8bLAQGgRHJZwNwF59USAXDk6wrdoVphvXrE4WJeK5TPG4iG2ujk28XEsSEt4xYQ/exec'; 

        function searchOrder() {
            const input = document.getElementById('searchName');
            const resultArea = document.getElementById('resultArea');
            const loading = document.getElementById('loading');
            const errorMsg = document.getElementById('errorMsg');

            // 1. å–å¾—è¼¸å…¥å€¼ä¸¦å»é™¤å‰å¾Œç©ºç™½
            const query = input.value.trim();

            // é‡ç½®ç•«é¢ç‹€æ…‹
            resultArea.innerHTML = '';
            resultArea.classList.add('hidden');
            errorMsg.classList.add('hidden');

            if (!query) {
                alert("è«‹è¼¸å…¥åç¨±æ‰èƒ½æŸ¥è©¢å–”ï¼");
                return;
            }

            // é¡¯ç¤ºè®€å–ä¸­
            loading.classList.remove('hidden');

            // 2. çµ„åˆ API ç¶²å€ (åŠ ä¸Š ?q=åå­—)
            // encodeURIComponent å¯ä»¥è™•ç†ç‰¹æ®Šç¬¦è™Ÿæˆ–ç©ºæ ¼
            const finalUrl = API_URL + "?q=" + encodeURIComponent(query);

            console.log("æ­£åœ¨æŸ¥è©¢:", finalUrl); // æ–¹ä¾¿æ‚¨åœ¨ç€è¦½å™¨ Console é™¤éŒ¯

            // 3. ç™¼é€è«‹æ±‚
            fetch(finalUrl)
                .then(response => response.json())
                .then(data => {
                    loading.classList.add('hidden');
                    
                    // å¦‚æœå›å‚³çš„æ˜¯ç©ºé™£åˆ— []
                    if (data.length === 0) {
                        resultArea.innerHTML = `
                            <div class="text-center py-8">
                                <p class="text-4xl mb-2">ğŸ¤·â€â™‚ï¸</p>
                                <p class="text-gray-600 font-bold">æŸ¥ç„¡è³‡æ–™</p>
                                <p class="text-gray-400 text-xs mt-1">è«‹ç¢ºèªåç¨±æ˜¯å¦å®Œå…¨æ­£ç¢º (å¤§å°å¯«éœ€ä¸€è‡´)</p>
                            </div>
                        `;
                        resultArea.classList.remove('hidden');
                        return;
                    }

                    // 4. é¡¯ç¤ºçµæœ
                    let html = '';
                    data.forEach(order => {
                        // åˆ¤æ–·ç‹€æ…‹é¡è‰²
                        const isSuccess = order.status.includes('æˆåŠŸ') || order.status.includes('æœ‰è²¨');
                        const statusClass = isSuccess ? 'bg-green-100 text-green-800 border-green-200' : 'bg-red-100 text-red-800 border-red-200';
                        const icon = isSuccess ? 'âœ…' : 'âŒ';

                        html += `
                            <div class="bg-white border rounded-lg p-4 shadow-sm hover:shadow-md transition">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-bold text-gray-800 text-lg">${order.item}</h3>
                                    <span class="px-2 py-1 rounded text-xs font-bold border ${statusClass}">
                                        ${icon} ${order.status}
                                    </span>
                                </div>
                                <div class="flex justify-between text-sm text-gray-500 mt-2 border-t pt-2">
                                    <span>è¨‚è³¼äººï¼š${order.name}</span>
                                    <span>æ•¸é‡ï¼š${order.qty}</span>
                                </div>
                            </div>
                        `;
                    });

                    resultArea.innerHTML = html;
                    resultArea.classList.remove('hidden');
                })
                .catch(err => {
                    loading.classList.add('hidden');
                    console.error("æŸ¥è©¢å¤±æ•—:", err);
                    errorMsg.textContent = "é€£ç·šç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
                    errorMsg.classList.remove('hidden');
                });
        }
    </script>
</body>
</html>
